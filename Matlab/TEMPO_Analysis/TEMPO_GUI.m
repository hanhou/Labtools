function fig = TEMPO_GUI()
% This is the machine-generated representation of a Handle Graphics object
% and its children.  Note that handle values may change when these objects
% are re-created. This may cause problems with any callbacks written to
% depend on the value of the handle at the time the object was saved.
% This problem is solved by saving the output as a FIG-file.
%
% To reopen this object, just type the name of the M-file at the MATLAB
% prompt. The M-file and its associated MAT-file must be on your path.
% 
% NOTE: certain newer features in MATLAB may not have been saved in this
% M-file due to limitations of this format, which has been superseded by
% FIG-files.  Figures which have been annotated using the plot editor tools
% are incompatible with the M-file/MAT-file format, and should be saved as
% FIG-files.

%clear all; 
%close all; 
clc;
load TEMPO_GUI

global LOAD_MU_DATA;
LOAD_MU_DATA = 1;

if ishandle(1000); close(1000); end ; h0 = figure(1000);  % HH20130826
set(h0, 'Color',[0.8 0.8 0.8], ...
	'Colormap',mat0, ...
	'FileName','E:\Matlab\TEMPO_GUI.m', ...
	'Name','=== TEMPO GUI ===', ...
    'NumberTitle','off',...
    'KeyPressFcn',@ShortCuts,...
	'PaperPosition',[18 180 576 432], ...
	'PaperUnits','points', ...
    'Units','pixels',...
    'Position',[    877    50   790   496], ...
    %{
        'Position',[2300 20 800 503], ...
    %}
    'Tag','TEMPO GUI', ...
	'ToolBar','none',...
    'HandleVisibility','off');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[206.25 208.5 379.5 153.75], ...
	'Style','frame', ...
	'Tag','Frame2');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 0.501960784313725 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[10.5 208.5 187.5 153.75], ...
	'Style','frame', ...
	'Tag','Frame1');
h_pathName = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[18 325.5 174 15.75], ...
	'String','Z:\Data\MOOG\HeTao\raw\', ...
	'Style','edit', ...
	'Tag','Pathname');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 0.501960784313725 0.501960784313725], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[18 344.25 61.5 12.75], ...
	'String','Data Path:', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 0.501960784313725 0.501960784313725], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[16.5 299.25 125.25 13.5], ...
	'String','Data File Name:', ...
	'Style','text', ...
	'Tag','StaticText2');

h_fileName = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[18 279.75 80 16.5], ...
	'Style','edit', ...
	'Tag','Filename');

h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
    'Units','pixel',...
	'Position',    [  14    11   355   210], ...
	'String',' ', ...
	'Style','listbox', ...
	'Tag','MessageBox', ...
	'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','TEMPO_GUI_Switchyard(''file info'');', ...
	'ListboxTop',0, ...
	'Position',[19.5 233.25 77.25 30.75], ...
	'String','INFO', ...
	'Tag','InfoButton');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','TEMPO_GUI_Switchyard(''load data'');', ...
	'ListboxTop',0, ...
	'Position',[112.5 233.25 77.25 30.75], ...
	'String','LOAD DATA (F3)', ...
	'Tag','LoadButton');
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[290   452    51    17], ...
	'String','Protocol:', ...
	'Style','text', ...
	'Tag','StaticText3');
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 1], ...
	'Enable','inactive', ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[ 336.0000  450.0000  178.0000   20.0000], ...
	'String',' ', ...
	'Style','edit', ...
	'Tag','Protocol', ...
	'Value',2);
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[290   427   164    15], ...
	'String','Analysis Options for this Protocol:', ...
	'Style','text', ...
	'Tag','StaticText4');
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[290   390   222    29], ...
	'String','  ', ...
	'Style','popupmenu', ...
	'Tag','AnalysisPopup', ...
	'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[409.5 339.75 74.25 15], ...
	'String','Analysis Start Time:', ...
	'Style','text', ...
	'Tag','StaticText5');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[410.25 302.25 74.25 15], ...
	'String','Analysis Stop Time:', ...
	'Style','text', ...
	'Tag','StaticText5');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[409.5 320.25 111 19.5], ...
	'String',mat1, ...
	'Style','popupmenu', ...
	'Tag','StartTimePopup', ...
	'Value',4);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'ListboxTop',0, ...
	'Position',[410.25 282.75 110.25 19.5], ...
	'String',mat2, ...
	'Style','popupmenu', ...
	'Tag','StopTimePopup', ...
	'Value',5);
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[ 297 374 152 13], ...
	'String','Start / Included / Excluded Trial', ...
	'Style','text', ...
	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[455.0000  375.0000   58.0000   13.0000], ...
	'String',' End Trial', ...
	'Style','text', ...
	'Tag','StaticText6');
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 1], ...
	'ListboxTop',0, ...
	'Position',[290   345  170    23], ...
	'Style','edit', ...
	'Tag','StartTrial', ...
	'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 1], ...
	'ListboxTop',0, ...
	'Position',[470   345  40    23], ...
	'Style','edit', ...
	'Tag','StopTrial', ...
	'Value',1);

h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 1 1], ...
	'Callback','global JustEditIt; JustEditIt = 2; TEMPO_GUI_Switchyard(''analyze'');', ...
	'ListboxTop',0, ...
	'Position',[ 410.0000  235.0000   90.0000   33.0000], ...
	'String','Show Firing', ...
	'Tag','ShowFiring');

h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[0.501960784313725 1 0.501960784313725], ...
	'Callback','global JustEditIt; JustEditIt = 0; TEMPO_GUI_Switchyard(''analyze'');', ...
	'ListboxTop',0, ...
	'Position',[ 510.0000  235.0000   90.0000   33.0000], ...
	'String','ANALYSIS(F4)', ...
	'Tag','AnalyzeButton');

% To edit the m.file quickly. HH20140531
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[1 .8 1], ...
	'Callback','global JustEditIt; JustEditIt = 1; TEMPO_GUI_Switchyard(''analyze'');', ...
	'ListboxTop',0, ...
	'Position',[700  235.0000   80.0000   33.0000], ...
	'String','Just Edit', ...
	'Tag','Just Edit');

% To Spike Sorting quickly. HH20140830
h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[0 .8 1], ...
	'Callback','TEMPO_GUI_Switchyard(''spike sorting'');', ...
	'ListboxTop',0, ...
	'Position',[ 610  235.0000   80.0000   33.0000], ...
	'String','SpkSort (F2)', ...
    'Tag','SpikeSorting');

% Axis for firing rate inspection
ax_1 = axes( 'Parent',h0,...
    'Unit','pix',...
    'Position',  [  411    33   364   185],...
    'Tag','FiringRate',...
    'NextPlot','replacechild');   % To keep tag after plotting. HH20150407


h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[214.5 233.75 57.75 15], ...
	'String','Spk Channel 1:', ...
	'Style','text', ...
	'Tag','StaticText7');

h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'ListboxTop',0, ...
	'Position',[279.75 236 210 15], ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','SpikePopup', ...
	'Value',1);

h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[214.5 210.75 57.75 15], ...
	'String','Spk Channel 2:', ...
	'Style','text', ...
	'Tag','StaticText7');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'ListboxTop',0, ...
	'Position',[279.75 214 210 15], ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','SpikePopup2', ...
	'Value',1);

h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[410 258.75 57.75 15], ...
	'String','Eye Channel:', ...
	'Style','text', ...
	'Tag','StaticText7');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'ListboxTop',0, ...
	'Position',[470 262 80 15], ...
	'String',' ', ...
	'Style','popupmenu', ...
	'Tag','EyePopup', ...
	'Value',1);


h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','TEMPO_GUI_Switchyard(''file open'');', ...
	'ListboxTop',0, ...
	'Position',[134.25 279 48.75 30], ...
	'String','BROWSE', ...
	'Tag','Pushbutton1');

h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','TEMPO_GUI_Switchyard(''view codes'');', ...
	'ListboxTop',0, ...
	'Position',[ 250.0000  235.0000   67.0000   33.0000], ...
	'String','Codes', ...
	'Tag','Pushbutton2');

h1 = uicontrol('Parent',h0, ...
	'Units','pix', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback','TEMPO_GUI_Switchyard(''view conditions'');', ...
	'ListboxTop',0, ...
	'Position',[ 330  235.0000    67.0000   33.0000], ...
	'String','Conditions', ...
	'Tag','Pushbutton2');

h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'Callback','TEMPO_GUI_Switchyard(''pick good trials'');', ...
	'ListboxTop',0, ...
	'Position',[500.75 240.25 57 15], ...
	'String','Good Trials', ...
	'Style','radiobutton', ...
	'Tag','Good Trials', ...
	'Value',1);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'Callback','TEMPO_GUI_Switchyard(''pick bad trials'');', ...
	'ListboxTop',0, ...
	'Position',[500.75 225.75 51 15], ...
	'String','Bad Trials', ...
	'Style','radiobutton', ...
   'Tag','Bad Trials');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'Callback','TEMPO_GUI_Switchyard(''use sync pulses'');', ...
	'ListboxTop',0, ...
	'Position',[500.75 210.75 75 15], ...
	'String','Use Sync Pulses', ...
	'Style','checkbox', ...
   'Tag','Sync Pulses', ...
	'Value',0);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[520.5 340.5 45 15], ...
	'String','Start Offset:', ...
	'Style','text', ...
	'Tag','Static Text4');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 0.501960784313725], ...
	'ListboxTop',0, ...
	'Position',[522.75 302.25 45 15], ...
	'String','Stop Offset:', ...
	'Style','text', ...
	'Tag','Static Text5');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'ListboxTop',0, ...
	'Position',[524.25 325.5 45 15], ...
	'Style','edit', ...
    'String','60', ...   % HH20130826
	'Tag','StartOffset');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'ListboxTop',0, ...
	'Position',[525 288 45 15], ...
	'Style','edit', ...
    'String','0', ... % HH20130826
	'Tag','StopOffset');
if nargout > 0, fig = h0; end

% Good stuffs for change filename. HH20130831
% f = fopen('Z:\Labtools\LastFileName.txt','r');
% fileName = fscanf(f,'%s');
% set(h_fileName,'string',fileName);
% fclose(f);

filePathName = textread('E:\Labtools\HH_Tools\DataHub\ZCdata\LastFileName.txt','%s');
filePath = filePathName{1};
fileName = filePathName{2};
set(h_pathName,'string',filePath);
set(h_fileName,'string',fileName);

hcp = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback',{@ChangeFileName,h_fileName}, ...
	'ListboxTop',0, ...
	'Position',[100 300 13 13], ...
	'String','+c', ...
    'Tag','Pushbutton3');

hcm = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback',{@ChangeFileName,h_fileName}, ...
	'ListboxTop',0, ...
	'Position',[100 285 13 13], ...
	'String','-c', ...
    'Tag','Pushbutton3');

hrp = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback',{@ChangeFileName,h_fileName}, ...
	'ListboxTop',0, ...
	'Position',[115 300 13 13], ...
	'String','+r', ...
    'Tag','Pushbutton3');

hrm = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.752941176470588 0.752941176470588 0.752941176470588], ...
	'Callback',{@ChangeFileName,h_fileName}, ...
	'ListboxTop',0, ...
	'Position',[115 285 13 13], ...
	'String','-r', ...
    'Tag','Pushbutton3');


% HH20130831
function ChangeFileName(src, ~, h_fileName)
fileName = get(h_fileName,'String');
c_pos = find(fileName == 'c', 1);
r_pos = find(fileName == 'r',1);
dot_pos = find(fileName=='.',1);

if ~isempty(dot_pos) fileName = fileName(1:dot_pos-1); end
    
if ~isempty(c_pos) && ~isempty(r_pos)
    switch get(src,'string')
        case '+c'
            value = str2double(fileName(c_pos+1:r_pos-1)) + 1;
            fileName = [fileName(1:c_pos) num2str(value) 'r1'];
        case '-c'
            value = str2double(fileName(c_pos+1:r_pos-1));
            value = value - 1 * (value~=1);
            fileName = [fileName(1:c_pos) num2str(value) 'r1'];
        case '+r'
            value = str2double(fileName(r_pos+1:end)) + 1;
            fileName = [fileName(1:r_pos) num2str(value)];
        case '-r'
            value = str2double(fileName(r_pos+1:end));
            value = value - 1 * (value~=1);
            fileName = [fileName(1:r_pos) num2str(value)];            
    end
    
    if ~isempty(dot_pos) fileName = [fileName '.htb']; end
    set(h_fileName,'String',fileName);
    
end

function ShortCuts(~,evt)
set(gcbf,'color','y');
pause(0.05);
set(gcbf,'color',[0.8000    0.8000    0.8000]);
drawnow;

global JustEditIt; 
switch evt.Key
    case 'f2'
        TEMPO_GUI_Switchyard('spike sorting');
    case 'f3'
        TEMPO_GUI_Switchyard('load data');
    case 'f4'
        JustEditIt = 0; TEMPO_GUI_Switchyard('analyze');
    case 'f5'  % +r
        ChangeFileName(findobj(gcbo,'String','+r'), [], findobj(gcbo,'Tag','Filename'));
    case 'f6'  % +c
        ChangeFileName(findobj(gcbo,'String','+c'), [], findobj(gcbo,'Tag','Filename'));
end





